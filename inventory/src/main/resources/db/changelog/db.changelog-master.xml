<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <!-- 3) Create the inventory table if not existing -->
    <changeSet id="3-create-inventory-table" author="you">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="inventory" schemaName="public"/>
            </not>
        </preConditions>

        <sql>
            CREATE TABLE public.inventory (
            inventory_id int8 GENERATED BY DEFAULT AS IDENTITY (
            INCREMENT BY 1
            MINVALUE 1
            MAXVALUE 9223372036854775807
            START 1
            CACHE 1
            NO CYCLE
            ) NOT NULL,
            product_name VARCHAR(255) NOT NULL,
            stock INT4 NOT NULL,
            CONSTRAINT inventory_pkey PRIMARY KEY (inventory_id),
            CONSTRAINT uk7hhm76pg86qc35tpb40pcvx5o UNIQUE (product_name)
            );
        </sql>
    </changeSet>

    <!-- 4) (Optional) Set REPLICA IDENTITY for Debezium CDC -->
    <changeSet id="4-set-replica-identity-inventory" author="you">
        <preConditions onFail="MARK_RAN">
            <tableExists tableName="inventory" schemaName="public"/>
        </preConditions>

        <sql>
            ALTER TABLE public.inventory REPLICA IDENTITY FULL;
        </sql>
    </changeSet>

</databaseChangeLog>
